# Nginx

nginx的优势
- 每个worker进程相对独立, 出错之后可以快速开启新的worker
- 低内存：一般情况下,10000个非活跃的HTTP Keep-Alive连接在nginx中仅消耗 2.5M内存
  - 10万个活跃连接也不需要10万个线程  =》 epoll，线程数量大致为CPU的核心数，线程轮询工作
- 高并发：单机支持10万以上的并发连接，取决于内存,10万远未封顶
- 热部署：master和worker的分离设计,可实现7x24小时不间断服务的前提下升级nginx可执行文件

## 部署静态网页

## 反向代理和负载均衡

正向代理：公司的代理服务器，你想访问外网就必须经过这个代理服务器，如果代理服务器把某些网站屏蔽了，你就访问不了了；要想访问这些屏蔽网站的话，就再弄个vpn，也就是新增一个网卡，通过这个vpn网卡进行转发。

=》 正向代理为客户端服务，反向代理为服务器服务

反向代理：

<img src="https://cdn.jsdelivr.net/gh/sparkling-wild-fire/picgo@main/blogs/pictures/20230406135048.png" alt="20230406135048" width="450" >

1. 客户端给服务器发送请求, 连接服务器, 用户不知道服务器地址, 只有反向代理服务器的地址是公开的
2. 请求直接发给反向代理服务器, 反向代理服务器将请求转发给后边的web服务器
   - web服务器 N 台
   - 反向代理服务器转发请求会轮询进行（最简单的负载均衡方法）
3. web服务器收到请求进行处理, 得到结果, 将处理结果发送给反向代理服务器
   - web服务器不能直接把结果返回给客户端，这样会新增一条连接
4. 反向代理服务器将拿到的结果转发给客户端

域名和ip：域名就是ip的一个别名，一个域名只能绑定一个ip，一个ip可以绑定多个域名。。。

## 安装和配置

1. 下载

官方地址: http://nginx.org/

2. Nginx相关依赖:
  - OpenSSL: http://www.openssl.org/
    - 密码库
    - 使用https进行通信的时候使用
  - ZLib下载: http://www.zlib.net/
    - 数据压缩
    - 安装:
      - ./configure
      - make
      - sudo make install
  - PCRE下载: http://www.pcre.org/
    - 解析正则表达式
    - 安装:
      - ./configure
      - make
      - sudo make install

3. 安装：
```shell
# nginx工作时候需要依赖三个库
# 三个参数=这三个库对应的源码安装目录
# 根据自己的电脑的库安装包的位置进行指定
./configure --with-openssl=../openssl-1.0.1t --with-pcre=../pcre-8.40 --with-zlib=../zlib-1.2.11
make
sudo make install
```
