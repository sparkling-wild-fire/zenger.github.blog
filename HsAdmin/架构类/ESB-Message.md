# ESB-Message

`上下文`存放本次调用的所有信息，如t2通道信息，proc实例信息（如内存数据库访问）等

插件分为二大类：普通插件与消息插件；

普通插件可以根据其是否需要配置信息、是否要用到其他插件来决定是否要实现IIoC接口(用来进行依赖注入)。


## 消息插件

这类插件除了满足插件的通用接口规范外，还要求实现IMessageService接口(参见：Include/service_interface.h)，
以便能被`插件容器`根据配置把多个消息插件组装成`消息流水线`，消息流水线中的消息插件完成恒生标准的ESB消息的传递、处理、转换等操作；

消息插件一般没有自己特定的接口，以IMessageService作为自己的主接口，标准的ESB消息对象可以在消息流水线中被`双向传递`；
在消息流水线中各消息插件通过调用邻居插件IMessageService接口中的PostMsg()方法，实现ESB消息在流水线中的双向传递。

根据插件在消息流水线中的角色不同，消息插件又可以分为：


1. 通信通道插件  => `t2/f2 ?`
一般配置在消息流水线的一端，根据特定的数据交换协议，对外提供数据通信功能，并将协议数据包封装成恒生标准的ESB消息，通过消息流水线转递；
<br>
金融基础件2.0项目提供了几种常用的通信通道插件，以支持恒生定义的几种数据交换协议；

2. 消息处理插件
一般配置在消息流水线的一端，完成对通过流水线传递过来的ESB消息的处理，处理结果一般生成相应的应答消息，通过流水线返回；

3. 消息路由插件
一般作为容器中多条消息流水线的级联插件，完成消息在容器内各流水线之间及通过流水线进行跨进程的消息转发；通信通道插件和消息处理插件都需要按指定规范通过消息流水线，向消息路由插件注册相关信息，作为消息路由时的基础信息；
<br>
一般可以直接使用金融基础件2.0项目提供的fsc_router插件即可，该插件提供一定的定制开发功能，可以定制各种基于消息内容的路由规则。

4. 消息过滤器插件
配置在消息流水线的中间，对经过该插件的消息进行一定的过滤操作；

## 插件

插件都是通过插件容器来进行管理的，如果需要，f2core容器允许同一个插件配置加载多次形成多个实例

由于每个插件在开发时显式定义了一个插件ID，对于多实例插件，在容器中以“插件ID：实例编号”来作为该插件每个实例的ID，但对于编号为0的缺省实例，则直接以插件ID来表示实例ID。

多实例插件，目前主要出现在一些消息插件。比如对于实现某种协议的消息通道插件，希望在一个容器里同时存在多个实例，每个实例使用不同的通信参数、安全等级来处理不同的下级连接。


t2sdk又是什么？