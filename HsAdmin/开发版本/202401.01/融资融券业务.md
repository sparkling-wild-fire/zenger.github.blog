# 宽途融资融券

[设计文档](http://rdcdocs.hundsun.com/pages/viewpage.action?pageId=66607220)

## 脚本

新增对接O32的融资融券开通脚本，web管理端支持菜单赋权（新增菜单界面）

## 接口

### 现有接口

| 模块          | 功能      | 功能号      | 备注         |
|-------------|---------|----------|------------|
| 列表信息        | 融券标的券列表 | 402307   | 定时器定时10s调用 |
|             | 融券负债明细  | 402304   | 定时器定时10s调用 |
|             | 担保证券    | 402306   | 定时器定时10s调用 |
|             | 证券持仓    | 402205   | 定时器定时5s调用  |
|             | 我的建议    | 402028、402029 | 需要接收主推消息   |
| 融券卖出(下单面板)  | 可卖数量    | 402304   | 定时器定时10s调用 |
|             | 维持担保比例  | 402304   | 定时器定时10s调用 |
|             | 本次占用保证金 | 402304   |            |
|             | 建议占用数量  | 402304   |            |
| 买券还券(下单面板)  | *       |  402304  |  |
| 担保券买卖(下单面板) | *       | 402304   |  |


### 后台新增的接口

| 功能      | 功能号     | 备注         |
|---------|---------|------------|
| 根据组合查询  融资融券配置信息 | 403880  |  |
| 根据组合查询 营业部资金账号信息 | 403881  |  |
| 建议占用数量    | 	403882 |  |
| 建议占用金额   | 403883  |   |
| 建议占用负债数量    | 403884  |    |
| 建议占用负债金额    | 403885  | |
|  交易占用负债数量  | 403886  |  |
| 交易占用负债金额 | 403887  |            |

## 实现功能

======融资融券======
1、增加系统参数，开启和关闭融资融券业务        系统参数表新增开关，在进行哪些操作前要判断这个开关？（比如下委托）
2、融资融券委托方向表和映射表脚本维护          O3委托方向表 (融资回购、购回、买入；融券回购、购回、卖出)
    TSTP_ENTRUSTDIRECTION,市场号只有银行间，上深交易所的
3、委托新增入参：合约编号、两融类型cashgroup_prop,委托静态表新增字段     下委托时这个两个字段插入静态表吗？还要做其他操作吗？只要402040加就可以了吧
*4、融资融券标的券 402307        已有接口  <disposer function_id="61402351" file="./functions/dataadapter/rzrqstock/qry.xml" note="融资融券标的券查询"/>
*5、担保券 402306               已有接口 
6、融资融券委托服务 svc_finsec_entr/aut_finsec_entr    后面这个也是O3的服务吗? 402040，402057   65180002没地方调啊
7、撤单服务921101                      对应402051接口 440281008，委托下达和撤单应正常
8、融资融券配置信息TRZRQCONFIG           O3的表
9、柜台可用接口                                 应该是已有接口，是哪个接口=>  402304
10、指令信息 新增：还券模式、两融类型              哪里的指令信息，数据表里？主推？查询结果？
11、日间交易消息处理                             涉及哪些消息？
12、持仓处理                                   要有哪里处理？ 增减，查询？                      
13、委托流水查询                                综合查询接口
14、支持上深北                                  怎么支持这三个，以及其他的市场怎么不支持（委托方向）


1、增加系统参数，开启和关闭融资融券业务        
    系统参数表新增开关，是后台在操作时要判断这个开关？（比如下委托），还是说前端做操作时调接口判断？
3、委托新增入参：合约编号、两融类型cashgroup_prop,委托静态表新增字段     
    下委托时这个两个字段插入静态表吗？还要做其他操作吗？只要402040加就可以了吗？
6、融资融券委托服务 svc_finsec_entr/aut_finsec_entr    
    后面这个也是O3的服务吗? 追踪到65180002发现没地方调啊
10、指令信息 新增：还券模式、两融类型              
    指令信息要在哪里新增，数据表里？主推？查询结果？
11、日间交易消息处理                             
    涉及哪些消息？  委托下达、撤单这些？
12、持仓处理                                   
    咋处理？        增减，查询？   


## 两融篮子委托

`svc_mlt_fin_entr`，目前只有非极速模式





```txt
i代表具体数字，具体由篮子委托数量决定，i最大为l_entrust_count - 1，各数据项之间以‘|’分隔        
1 l_basecombi_id             N      10     组合序号  N8  Y
2 l_daily_instruction_no     N      10     非指令委托传0 Y
3 l_index_daily_modify       N      10     非指令委托传0 Y 
4 c_market_no                C      1      市场代码      Y
5 vc_report_code             C      8      申报代码      Y
6 c_invest_type              C      1      投资类型：    Y  
7 c_entrust_direction        C      2      委托方向      Y
8 l_entrust_amount           N      12     委托数量      Y
9 c_price_type               C      1      价格类型      Y 
10 en_entrust_price          N      16,8   委托价格      Y  市价委托时价格填入0,限价时必须传符合报价的非0值。    
11 c_busin_class             C      2      业务分类      Y  只支持融资融券业务
12 vc_stockholder_id         C      30     股东代码      N 默认值 ""
13 vc_report_seat            C      6      持仓席位      N 默认值 ""
14 vc_trade_seat             C      6      交易席位      N 默认值 ""
15 c_launch_flag             C      1      发起方式      N  数据字典10088
16 c_entrust_origin          C      1      委托来源      N 不传取外层的
17 l_operator_no             N      8      操作员        N 不传默认为0
18 l_instance_id             N      10     实例序号      N 默认值 0
19 l_batch_serial_no         N      10     委托批号      N 不传取外层的
20 vc_rival_holdid           C      12     对手股东      N 默认值 ""  提取和交存时为必传字段
21 vc_rival_seat             C      6      对手方席位    N 默认值 ""  提取和交存时为必传字段
22 en_balance              N     16,8   还款金额      N 直接还款时必传
23 l_target_combi_id         N      10     目标组合      N 默认值 0  提取和交存时为必传
24 c_target_invest_type      C      1      对手方投资类型N 默认值 "" 提取和交存时为必传
25 l_period                  N      8      剩余期限      N 默认值 0 
26 l_valid_date              N      8      有效日期      N 默认值 业务日期
27 l_market_valid_date      N     8      市场有效日期  N 默认值 业务日期
28 vc_valid_type          C     1      有效类型      N 默认值 "4"
29 c_special_flag          C      1    特殊业务标识  N 默认值'0' 直接还券即时还券模式必须传入3，否则当做非即时模式处理
30 c_cashgroup_prop          C      1    融资融券头寸性质 N 空 "值域为0-不区分；1-普通；2-专项 融资买入、直接还款、卖券还款、融券卖出、直接还券、卖券还券业务，如果专项融资融券则传入2-专项，否则传入1-普通，其他不传"
31 l_cashgroup_id          N     10     头寸编号      N 默认值 0 支持融资融券金证柜台专项，融资买入、融券卖出时传入，其他不需要传入
32 l_open_date              N     8      开仓日期      N 默认值 0 支持指定合约还款时需要传入
33 vc_compact_id          C      32    合约编号      N 默认值 "" 卖券还款、直接还款、买券还券、直接还券填写后表示指定先还哪笔合约负债，不填按柜台默认规则归还；合约展期必填
34 c_fair_flag               C      1      公平交易标志  N 不传取外层的
35 vc_algo_ordid             C      60     子单编号      N 
36 l_autotrade_no            N      10     自动交易编号  N 不传取外层的
37 l_schema_id               N      10     策略交易方案序号 N 不传取外层的
38 l_comp_id              N     10     算法交易提供商 N 默认值 0
39 c_dma                     C      1      是否DMA       N 不传取外层的
40 vc_broker_no              C      64     券商编号      N 当c_dma为2-非DMA时，不传取外层的，否则为空
41 l_strategy_no             N      10     策略号        N 当c_dma为2-非DMA时，不传取外层的，否则为空
42 vc_strategy_parameter     C      2000   策略参数      N 当c_dma为2-非DMA时，不传取外层的，否则为空
43 c_approve_flag            C      1      审批标志      N 不传默认为'0' 值域：'0'-普通 '1'-强制不审批 '2'-强制自动审批 '3'-强制手工审批
44 l_invest_adviser          N      8      投资顾问      N 不传取外层的
45 vc_adviser_station        C      256    投顾站点      N 不传取外层的
46 l_extsystem_id            N      8      第三方系统自定义号 N  不传默认为0
47 vc_third_reff             C      256    第三方备注    N 默认值 ""
48 vc_summary                C      4000   备注          N 当c_dma为2-非DMA时，不传取外层的，否则为空
49 vc_ip_address             C      64     网卡地址      N 不传取外层的
50 vc_mac                    C      20     Mac地址       N 不传取外层的
51 vc_volserial_no           C      128    硬盘序列号    N 不传取外层的
52 vc_terminalinfo_extend    C      1024   委托扩展信息  N 不传取外层的
```